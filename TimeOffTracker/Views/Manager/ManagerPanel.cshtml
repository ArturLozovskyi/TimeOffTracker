@using TimeOffTracker.Models.ManagerModels;
@model ListRequestsModel
@{
    ViewBag.Title = "ManagerPanel";
}

<br />
<span>
    You are a manager, this is very good! The table below shows all active vacation requests. Help your employee go on vacation or leave the poor fellow to work on!
</span>

<br /><br />


@if (Model.Items.Count == 0)
{
    <span>No active requests</span>
}
else
{
    <div class="panel table-responsive">
        <div id="modDialog" class="modal fade">
            <div id="dialogContent" class="modal-dialog"></div>
        </div>

        <table class="table table-striped table-hover ">
            <tbody id="parent" class="table-responsive">
                <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>С</th>
                    <th>По</th>
                    <th>Type</th>
                    <th>Description</th>
                    <th>Result</th>
                    <th>Details</th>
                </tr>
                @foreach (var request in Model.Items)
                {
                    <tr>
                        <td>@request.FullNameEmployee</td>
                        <td>@request.EmailEmployee</td>
                        <td>@request.DateStart</td>
                        <td>@request.DateEnd</td>
                        <td>@request.VacationType</td>
                        <td>@request.Description</td>
                        <td>
                            @using (Html.BeginForm("Confirm", "Manager", FormMethod.Post))
                            {
                                <input type="hidden" value="@request.Id" name="id" />
                                <button type="submit" class="btn btn-success">Подтвердить</button>
                            }
                            <button class="trigger-btn btn btn-danger" id="reject-btn">Отказ</button>
                            @using (Html.BeginForm("Reject", "Manager", FormMethod.Post, htmlAttributes: new { @class = "form-reject-request" }))
                            {
                                <input type="hidden" value="@request.Id" name="id" />
                                <input type="text" value="@request.Reason" name="reason" required /><br />
                                <button type="submit" class="btn btn-danger">Подтвердить отказ</button>
                            }
                            <button class="btn-cancel-reject btn btn-warning" onclick="cancelReject()">Отмена</button>
                        </td>
                        <td>
                            @Html.ActionLink("Info", "Details", new { id = request.Id }, new { @class = "show-datails-modal btn btn-info", @name = "id" })
                        </td>
                    </tr>
                }
            </tbody>
        </table>
        <!-- Add to scripts folder -->
        @section scripts{
            <script type="text/javascript">
                $(function () {
                    $.ajaxSetup({ cache: false });
                    $(".show-datails-modal").click(function (e) {
                        e.preventDefault();
                        $.get(this.href, function (data) {
                            $('#dialogContent').html(data);
                            $('#modDialog').modal('show');
                        });
                    });
                })
            </script>
        }
    </div>
}

@Scripts.Render("~/scripts/actionShowReject.js")